<template>
  <div class="security-form-container">
    <a-card title="填写安全检测信息单">
      <a-form
        ref="formRef"
        :model="formState"
        :label-col="{ span: 6 }"
        :wrapper-col="{ span: 18 }"
        autocomplete="off"
      >
        <!-- 系统名称 -->
        <a-form-item
          label="系统名称"
          name="systemName"
          :rules="[{ required: true, message: '请选择系统名称' }]"
        >
          <a-space>
            <a-select
              v-model:value="formState.systemName"
              placeholder="--请选择--"
              style="width: 300px"
            >
              <a-select-option value="system1">系统1</a-select-option>
              <a-select-option value="system2">系统2</a-select-option>
              <a-select-option value="system3">系统3</a-select-option>
            </a-select>
            <a-button type="primary" @click="handleAddApp">
              <template #icon><PlusOutlined /></template>
              新增应用
            </a-button>
          </a-space>
        </a-form-item>

        <!-- 部门信息 -->
        <a-row :gutter="16">
          <a-col :span="12">
            <a-form-item label="业务主管部门" name="businessDept">
              <a-input v-model:value="formState.businessDept" placeholder="请输入" />
            </a-form-item>
          </a-col>
          <a-col :span="12">
            <a-form-item label="系统运营部门" name="operationDept">
              <a-input v-model:value="formState.operationDept" placeholder="请输入" />
            </a-form-item>
          </a-col>
        </a-row>
        
        <a-row :gutter="16">
          <a-col :span="12">
            <a-form-item label="系统建设部门" name="constructionDept">
              <a-input v-model:value="formState.constructionDept" placeholder="请输入" />
            </a-form-item>
          </a-col>
          <a-col :span="12">
            <a-form-item label="系统运维部门" name="maintenanceDept">
              <a-input v-model:value="formState.maintenanceDept" placeholder="请输入" />
            </a-form-item>
          </a-col>
        </a-row>

        <!-- 管理员选择 -->
        <a-row :gutter="16">
          <a-col :span="12">
            <a-form-item
              label="请选择平台管理员"
              name="platformAdmin"
              :rules="[{ required: true, message: '请选择平台管理员' }]"
            >
              <a-select
                v-model:value="formState.platformAdmin"
                placeholder="请选择需要通知平台管理员"
              >
                <a-select-option value="admin1">管理员1</a-select-option>
                <a-select-option value="admin2">管理员2</a-select-option>
                <a-select-option value="admin3">管理员3</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>
          <a-col :span="12">
            <a-form-item
              label="请选择安全领导"
              name="securityLeader"
              :rules="[{ required: true, message: '请选择安全领导' }]"
            >
              <a-select
                v-model:value="formState.securityLeader"
                placeholder="请选择需要审批得安全领导"
              >
                <a-select-option value="leader1">安全领导1</a-select-option>
                <a-select-option value="leader2">安全领导2</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>
        </a-row>

        <!-- 条线领导和申请类型 -->
        <a-row :gutter="16">
          <a-col :span="12">
            <a-form-item
              label="请选择条线领导"
              name="lineLeader"
              :rules="[{ required: true, message: '请选择条线领导' }]"
            >
              <a-select
                v-model:value="formState.lineLeader"
                placeholder="请选择需要审批得条线领导"
              >
                <a-select-option value="line1">条线领导1</a-select-option>
                <a-select-option value="line2">条线领导2</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>
          <a-col :span="12">
            <a-form-item
              label="申请类型"
              name="applicationType"
              :rules="[{ required: true, message: '请选择申请类型' }]"
            >
              <a-select
                v-model:value="formState.applicationType"
                placeholder="--请选择--"
              >
                <a-select-option value="type1">安全测试</a-select-option>
                <a-select-option value="type2">漏洞修复</a-select-option>
                <a-select-option value="type3">应急响应</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>
        </a-row>

        <!-- 检测类型和检测环境 -->
        <a-row :gutter="16">
          <a-col :span="12">
            <a-form-item
              label="检测类型"
              name="detectionType"
              :rules="[{ required: true, message: '请选择检测类型' }]"
            >
              <a-select
                v-model:value="formState.detectionType"
                placeholder="--请选择--"
              >
                <a-select-option value="penetration">渗透测试</a-select-option>
                <a-select-option value="vulnerability">漏洞扫描</a-select-option>
                <a-select-option value="code">代码审计</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>
          <a-col :span="12">
            <a-form-item
              label="检测环境"
              name="detectionEnv"
              :rules="[{ required: true, message: '请选择检测环境' }]"
            >
              <a-select
                v-model:value="formState.detectionEnv"
                placeholder="--请选择--"
              >
                <a-select-option value="http://172.19.244.63:80">
                  http://172.19.244.63:80
                </a-select-option>
                <a-select-option value="test">测试环境</a-select-option>
                <a-select-option value="prod">生产环境</a-select-option>
              </a-select>
            </a-form-item>
          </a-col>
        </a-row>

        <!-- 系统存在的风险 -->
        <a-form-item
          label="系统存在的风险"
          name="systemRisk"
          :rules="[{ required: true, message: '请输入系统存在的风险' }]"
        >
          <a-textarea
            v-model:value="formState.systemRisk"
            placeholder="请输入系统存在的风险"
            :rows="4"
          />
        </a-form-item>

        <!-- 描述 -->
        <a-form-item
          label="描述"
          name="description"
          :rules="[{ required: true, message: '请输入描述信息' }]"
        >
          <a-textarea
            v-model:value="formState.description"
            placeholder="请填写被测试系统的IP地址，URL登陆入口及系统基本信息"
            :rows="6"
          />
        </a-form-item>

        <!-- 操作按钮 -->
        <a-form-item :wrapper-col="{ offset: 6, span: 18 }">
          <a-space>
            <a-button @click="handleBack">
              <template #icon><RollbackOutlined /></template>
              返回
            </a-button>
            <a-button type="primary" @click="handleSubmit">
              <template #icon><CheckOutlined /></template>
              提交
            </a-button>
          </a-space>
        </a-form-item>
      </a-form>
    </a-card>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue';
import { message } from 'ant-design-vue';
import {
  PlusOutlined,
  RollbackOutlined,
  CheckOutlined,
} from '@ant-design/icons-vue';
import type { FormInstance } from 'ant-design-vue';

// 表单ref
const formRef = ref<FormInstance>();

// 表单数据
const formState = reactive({
  systemName: undefined,
  businessDept: '',
  operationDept: '',
  constructionDept: '',
  maintenanceDept: '',
  platformAdmin: undefined,
  securityLeader: undefined,
  lineLeader: undefined,
  applicationType: undefined,
  detectionType: undefined,
  detectionEnv: 'http://172.19.244.63:80',
  systemRisk: '',
  description: '',
});

// 新增应用
const handleAddApp = () => {
  message.info('新增应用功能待实现');
};

// 返回
const handleBack = () => {
  message.info('返回上一页');
  // 实际使用时替换为路由跳转
  // router.back();
};

// 提交表单
const handleSubmit = async () => {
  try {
    // 校验表单
    await formRef.value?.validateFields();
    
    // 提交数据
    console.log('提交的表单数据：', formState);
    message.success('提交成功！');
    
    // 实际使用时调用API
    // await submitSecurityForm(formState);
  } catch (error) {
    console.error('表单验证失败:', error);
    message.error('请填写完整的必填项信息');
  }
};
</script>

<style scoped lang="less">
.security-form-container {
  padding: 20px;
  background: #f0f2f5;
  min-height: 100vh;

  :deep(.ant-card) {
    max-width: 1200px;
    margin: 0 auto;
  }

  :deep(.ant-card-head-title) {
    font-size: 18px;
    font-weight: 500;
  }

  // 必填项标记样式
  :deep(.ant-form-item-required) {
    &::before {
      display: inline-block;
      margin-right: 4px;
      color: #ff4d4f;
      font-size: 14px;
      font-family: SimSun, sans-serif;
      line-height: 1;
      content: '*';
    }
  }
}
</style>