<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››ç¯å½¢å›¾æ•°æ®å¯è§†åŒ–</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-range {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .date-range label {
            font-weight: bold;
            margin-right: 10px;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-wrapper {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chart-wrapper:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .chart-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .chart {
            width: 100%;
            height: 200px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .stats-card h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2em;
        }

        .stats-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .stats-label {
            color: #666;
            font-size: 0.9em;
        }

        .summary-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
        }

        .update-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .update-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .container {
                padding: 15px;
            }
            
            .chart {
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å®‰å…¨æ¼æ´åˆ†ææŠ¥å‘Š</h1>
            <div class="date-range">
                <label>ç»Ÿè®¡æ—¶é—´:</label>
                <span>2025-06-18 14:21:01 â€” 2025-08-18 14:21:01</span>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-wrapper">
                <div id="hostChart" class="chart"></div>
            </div>
            <div class="chart-wrapper">
                <div id="systemChart" class="chart"></div>
            </div>
            <div class="chart-wrapper">
                <div id="appChart" class="chart"></div>
            </div>
            <div class="chart-wrapper">
                <div id="networkChart" class="chart"></div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stats-card">
                <h3>åº”ç”¨ç»„ä»¶æ¼æ´</h3>
                <div class="stats-number" id="appCount">1</div>
                <div class="stats-label">ä»Šæ—¥æ–°å¢: <span style="color: #dc3545;">0</span></div>
                <div class="stats-label">å¹³å‡å¤„ç†æ—¶é•¿: <span style="color: #007bff;">0</span></div>
            </div>
            <div class="stats-card">
                <h3>ç½‘ç»œè®¾å¤‡æ¼æ´</h3>
                <div class="stats-number" id="networkCount">3</div>
                <div class="stats-label">ä»Šæ—¥æ–°å¢: <span style="color: #dc3545;">0</span></div>
                <div class="stats-label">å¹³å‡å¤„ç†æ—¶é•¿: <span style="color: #007bff;">0.00</span></div>
            </div>
        </div>

        <div class="summary-info">
            <h3>ğŸ“Š æ•°æ®æ€»è§ˆ</h3>
            <p><strong>éªŒè¯ä¿¡æ¯:</strong> å››ä¸ªç¯å½¢å›¾æ˜¾ç¤ºåŸå§‹æ•°å€¼ï¼Œæ‰‡å½¢å¤§å°æŒ‰ç™¾åˆ†æ¯”æ¯”ä¾‹æ˜¾ç¤º</p>
            <p><strong>åŸå§‹æ•°æ®æ€»è®¡:</strong> <span id="originalTotal">293</span> ä¸ªæ¼æ´</p>
            <p><strong>æ•°æ®æ›´æ–°:</strong> æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°ï¼Œè‡ªåŠ¨ä¿æŒç™¾åˆ†æ¯”å¹³è¡¡</p>
            
            <div style="margin-top: 15px;">
                <button class="update-button" onclick="simulateDataUpdate1()">æ¨¡æ‹Ÿæ›´æ–°1</button>
                <button class="update-button" onclick="simulateDataUpdate2()">æ¨¡æ‹Ÿæ›´æ–°2</button>
                <button class="update-button" onclick="resetToOriginal()">é‡ç½®æ•°æ®</button>
            </div>
        </div>
    </div>

    <script>
        // åŸå§‹æ•°æ®
        const rawData = {
            host: 226,      // ä¸»æœºæ¼æ´
            system: 36,     // ç³»ç»Ÿæ¼æ´  
            app: 27,        // åº”ç”¨ç»„ä»¶æ¼æ´
            network: 4      // ç½‘ç»œè®¾å¤‡æ¼æ´
        };

        // æ•°æ®å½’ä¸€åŒ–å¤„ç† - ç¡®ä¿æ€»å’Œä¸º100%
        function normalizeData(data, targetTotal = 100) {
            const currentTotal = Object.values(data).reduce((sum, value) => sum + value, 0);
            const normalized = {};
            
            Object.keys(data).forEach(key => {
                normalized[key] = (data[key] / currentTotal) * targetTotal;
            });
            
            return normalized;
        }

        // è·å–å½’ä¸€åŒ–åçš„æ•°æ®
        let normalizedData = normalizeData(rawData);

        // EChartsé…ç½®
        const chartConfigs = [
            {
                id: 'hostChart',
                title: 'ä¸»æœºæ¼æ´',
                originalValue: rawData.host,
                color: '#d32f2f'
            },
            {
                id: 'systemChart', 
                title: 'ç³»ç»Ÿæ¼æ´',
                originalValue: rawData.system,
                color: '#ff9800'
            },
            {
                id: 'appChart',
                title: 'åº”ç”¨ç»„ä»¶æ¼æ´', 
                originalValue: rawData.app,
                color: '#3f51b5'
            },
            {
                id: 'networkChart',
                title: 'ç½‘ç»œè®¾å¤‡æ¼æ´',
                originalValue: rawData.network,
                color: '#4caf50'
            }
        ];

        // åˆ›å»ºå•ä¸ªç¯å½¢å›¾çš„é…ç½®
        function createRingChartOption(config) {
            // è®¡ç®—æ€»æ•°ç”¨äºç™¾åˆ†æ¯”è®¡ç®—
            const total = Object.values(rawData).reduce((sum, value) => sum + value, 0);
            const percentage = (config.originalValue / total) * 100;
            
            return {
                title: {
                    text: config.title,
                    left: 'center',
                    bottom: '5%',
                    textStyle: {
                        fontSize: 14,
                        color: '#333',
                        fontWeight: 'bold'
                    }
                },
                series: [{
                    type: 'pie',
                    radius: ['50%', '75%'],
                    center: ['50%', '40%'],
                    startAngle: 90,
                    data: [
                        {
                            value: percentage, // ç”¨ç™¾åˆ†æ¯”æ§åˆ¶æ‰‡å½¢å¤§å°
                            name: config.title,
                            itemStyle: {
                                color: config.color,
                                shadowBlur: 10,
                                shadowColor: 'rgba(0,0,0,0.3)'
                            },
                            label: {
                                show: true,
                                position: 'center',
                                fontSize: 18,
                                fontWeight: 'bold',
                                formatter: function() {
                                    return config.originalValue; // æ˜¾ç¤ºåŸå§‹æ•°å€¼
                                },
                                color: config.color
                            }
                        },
                        {
                            value: 100 - percentage,
                            name: 'å…¶ä»–',
                            itemStyle: {
                                color: '#f0f0f0'
                            },
                            label: {
                                show: false
                            },
                            tooltip: {
                                show: false
                            }
                        }
                    ],
                    emphasis: {
                        scale: true,
                        scaleSize: 5
                    },
                    animationType: 'scale',
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return Math.random() * 200;
                    }
                }],
                tooltip: {
                    trigger: 'item',
                    formatter: function(params) {
                        if (params.name !== 'å…¶ä»–') {
                            return `<div style="padding: 8px;">
                                <strong>${params.name}</strong><br/>
                                æ•°é‡: ${config.originalValue}<br/>
                                å æ¯”: ${percentage.toFixed(1)}%
                            </div>`;
                        }
                        return false;
                    },
                    backgroundColor: 'rgba(50,50,50,0.9)',
                    borderColor: config.color,
                    borderWidth: 2,
                    textStyle: {
                        color: '#fff'
                    }
                }
            };
        }

        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        function initCharts() {
            chartConfigs.forEach(config => {
                const chartDom = document.getElementById(config.id);
                if (chartDom) {
                    const myChart = echarts.init(chartDom);
                    const option = createRingChartOption(config);
                    myChart.setOption(option);
                    
                    // å“åº”å¼å¤„ç†
                    window.addEventListener('resize', function () {
                        myChart.resize();
                    });
                }
            });
        }

        // éªŒè¯æ•°æ®æ€»å’Œ
        function validateDataSum() {
            const total = Object.values(rawData).reduce((sum, value) => sum + value, 0);
            console.log('åŸå§‹æ•°æ®æ€»å’Œ:', total);
            
            const originalTotal = total;
            document.getElementById('originalTotal').textContent = originalTotal;
            
            // æ˜¾ç¤ºæ¯ä¸ªå›¾è¡¨çš„æ•°å€¼å’Œç™¾åˆ†æ¯”
            chartConfigs.forEach(config => {
                const percentage = (config.originalValue / total) * 100;
                console.log(`${config.title}: ${config.originalValue} (${percentage.toFixed(1)}%)`);
            });
            
            // éªŒè¯ç™¾åˆ†æ¯”æ€»å’Œæ˜¯å¦ä¸º100%
            const percentageSum = chartConfigs.reduce((sum, config) => {
                return sum + (config.originalValue / total) * 100;
            }, 0);
            console.log('ç™¾åˆ†æ¯”æ€»å’Œ:', percentageSum.toFixed(2) + '%');
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            document.getElementById('appCount').textContent = rawData.app || 0;
            document.getElementById('networkCount').textContent = rawData.network || 0;
        }

        // åŠ¨æ€æ›´æ–°æ•°æ®çš„å‡½æ•°
        function updateChartData(newData) {
            // æ›´æ–°å…¨å±€rawData
            Object.assign(rawData, newData);
            
            // æ›´æ–°é…ç½®ä¸­çš„åŸå§‹å€¼
            chartConfigs.forEach((config, index) => {
                const key = Object.keys(newData)[index];
                config.originalValue = newData[key];
                
                const chartDom = document.getElementById(config.id);
                if (chartDom) {
                    const chart = echarts.getInstanceByDom(chartDom);
                    if (chart) {
                        const newOption = createRingChartOption(config);
                        chart.setOption(newOption, true);
                    }
                }
            });
            
            validateDataSum();
        }

        // æ¨¡æ‹Ÿæ•°æ®æ›´æ–°å‡½æ•°
        function simulateDataUpdate1() {
            updateChartData({
                host: 300,
                system: 80, 
                app: 60,
                network: 20
            });
        }

        function simulateDataUpdate2() {
            updateChartData({
                host: 150,
                system: 120, 
                app: 90,
                network: 40
            });
        }

        function resetToOriginal() {
            updateChartData({
                host: 226,
                system: 36,
                app: 27,
                network: 4
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            validateDataSum();
            
            // æ·»åŠ åŠ è½½åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                document.querySelectorAll('.chart-wrapper').forEach((wrapper, index) => {
                    setTimeout(() => {
                        wrapper.style.opacity = '0';
                        wrapper.style.transform = 'translateY(20px)';
                        wrapper.style.transition = 'all 0.6s ease';
                        
                        setTimeout(() => {
                            wrapper.style.opacity = '1';
                            wrapper.style.transform = 'translateY(0)';
                        }, 100);
                    }, index * 200);
                });
            }, 100);
        });
    </script>
</body>
</html>