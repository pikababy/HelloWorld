这是一个非常经典的后台管理系统需求。在 Vben Admin (基于 Vue 3 + Ant Design Vue) 中开发角色权限分配页面，核心难点在于将扁平的菜单数据（附件二）转换为 UI 组件需要的树形结构，并将权限数据（附件三）回显到树状图中。
根据你提供的截图和数据结构，我为你整理了完整的实现方案。
核心思路
 * 数据转换：后端返回的是扁平数组（附件二），我们需要根据 parentMenu (父级标识) 和 authIdentifier (自身标识) 将其转化为树形结构。
 * 组件选择：可以使用 Vben 封装的 BasicTree，也可以直接使用 Ant Design Vue 的 a-tree。为了更直观地控制数据，下面代码使用 a-tree（Vben 底层也是这个）。
 * 数据回显：将附件三中的 authorityCodes 数组赋值给树组件的 checkedKeys。
1. 定义数据接口 (TypeScript)
根据你的截图（附件一、二），我们需要定义如下类型，以确保代码提示正确。
// 菜单项接口 (基于附件二)
interface MenuItem {
  id: number;
  menuName: string; // 显示名称，如 "待办事项"
  authIdentifier: string; // 唯一标识，如 "UnfinishedList"
  parentMenu: string | null; // 父级标识，如 "UnfinishedList" 或 null
  menuType: string;
  status: string;
  children?: MenuItem[]; // 转换后添加的子节点
}

// 权限接口 (基于附件三)
interface PermissionResult {
  authorityCodes: string[]; // 已拥有的权限标识列表
  // ...其他字段
}

2. 核心工具函数：扁平数组转树结构
这是最关键的一步。因为你的数据是通过 authIdentifier 字符串来关联父子级的，而不是传统的数字 ID。
/**
 * 将扁平菜单列表转换为树形结构
 * @param list 后端返回的扁平菜单数组
 * @returns 树形结构数组
 */
function listToTree(list: MenuItem[]) {
  const map: Record<string, MenuItem> = {};
  const tree: MenuItem[] = [];

  // 1. 初始化 Map，方便通过 authIdentifier 快速查找
  list.forEach((item) => {
    // 浅拷贝对象，并初始化 children
    map[item.authIdentifier] = { ...item, children: [] };
  });

  // 2. 构建树
  list.forEach((item) => {
    const node = map[item.authIdentifier];
    // 注意：你的数据中 parentMenu 是字符串，如果为 null 则是根节点
    const parentAuthId = item.parentMenu;

    if (parentAuthId && map[parentAuthId]) {
      // 如果有父级，且父级在数据中存在，则加入父级的 children
      map[parentAuthId].children!.push(node);
    } else {
      // 没有父级，则是根节点 (如 "待办事项")
      tree.push(node);
    }
  });

  return tree;
}

3. Vue 3 完整代码实现
你可以新建一个组件 RolePermissionDrawer.vue 或直接在你的页面中使用。
<template>
  <div class="p-4 bg-white">
    <div class="mb-4">
      <a-button type="primary" :loading="loading" @click="handleSave">保存权限</a-button>
    </div>

    <a-tree
      v-if="treeData.length > 0"
      v-model:checkedKeys="checkedKeys"
      v-model:expandedKeys="expandedKeys"
      :tree-data="treeData"
      checkable
      :field-names="fieldNames"
      :height="600" 
      default-expand-all
    >
      <template #title="{ menuName }">
        <span>{{ menuName }}</span>
      </template>
    </a-tree>
    
    <div v-else class="py-10 text-center text-gray-500">
      加载中或无数据...
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';
// 假设你使用 vben 的 defHttp，或者 axios
// import { defHttp } from '/@/utils/http/axios'; 

// 定义响应式数据
const loading = ref(false);
const treeData = ref<MenuItem[]>([]);
const checkedKeys = ref<string[]>([]); // 选中的节点 (对应 authIdentifier)
const expandedKeys = ref<string[]>([]); // 展开的节点

// 定义字段映射，告诉 Tree 组件读取哪些字段
const fieldNames = {
  children: 'children',
  title: 'menuName', // 对应附件一中的 "待办事项"
  key: 'authIdentifier', // 对应附件一中的 "UnfinishedList"，作为唯一key
};

// 模拟 API 请求：获取菜单列表 (附件二数据)
const fetchMenuList = async () => {
  // 模拟数据，实际开发请替换为 await defHttp.get(...)
  const rawData = [
    { id: 1, menuName: "待办事项", authIdentifier: "UnfinishedList", parentMenu: null, menuType: "0", status: "1" },
    { id: 2, menuName: "待办列表", authIdentifier: "TodoList", parentMenu: "UnfinishedList", menuType: "0", status: "1" },
    { id: 3, menuName: "超时列表", authIdentifier: "TimeoutList", parentMenu: "UnfinishedList", menuType: "0", status: "1" },
    { id: 4, menuName: "风险提示", authIdentifier: "RiskWarning", parentMenu: null, menuType: "0", status: "1" },
    // ... 其他数据
  ];
  
  // 转换数据结构
  treeData.value = listToTree(rawData);
  
  // 默认展开所有一级节点
  expandedKeys.value = rawData
    .filter(i => !i.parentMenu)
    .map(i => i.authIdentifier);
};

// 模拟 API 请求：获取当前角色的权限 (附件三数据)
const fetchRolePermissions = async () => {
  // 模拟数据：data.authorityCodes
  const apiResponse = {
    authorityCodes: ["TodoList", "RiskWarning", "TimeoutList"] // 假设已拥有的权限
  };
  
  // 回显选中状态
  // 注意：如果是父子关联模式(checkStrictly=false)，如果父节点下所有子节点都被选中，
  // 只需要传入子节点的 key，AntDesign 会自动勾选父节点。
  // 如果后端返回了父节点 Key 但子节点没全选，可能会导致显示半选问题，需要根据实际业务过滤。
  checkedKeys.value = apiResponse.authorityCodes;
};

// 工具函数：listToTree (同上文)
function listToTree(list: any[]) {
  const map: any = {};
  const tree: any[] = [];
  list.forEach(item => map[item.authIdentifier] = { ...item, children: [] });
  list.forEach(item => {
    const node = map[item.authIdentifier];
    if (item.parentMenu && map[item.parentMenu]) {
      map[item.parentMenu].children.push(node);
    } else {
      tree.push(node);
    }
  });
  return tree;
}

// 保存操作
const handleSave = () => {
  loading.value = true;
  console.log("最终提交的权限Keys:", checkedKeys.value);
  
  // 调用保存 API
  // await saveRoleApi({ roleId: xxx, permissions: checkedKeys.value });
  
  setTimeout(() => loading.value = false, 1000);
};

onMounted(async () => {
  loading.value = true;
  await fetchMenuList();
  await fetchRolePermissions();
  loading.value = false;
});
</script>

关键点解析 (针对你的附件)
 * authIdentifier 是关键：
   * 在附件二中，id 是数字（如 1, 2, 3），但 parentMenu 指向的是字符串（如 "UnfinishedList"）。
   * 所以：在 <a-tree> 的 :field-names 配置中，必须设置 key: 'authIdentifier'。如果你设置成 id，树状图将无法正确渲染层级，或者无法正确回显数据。
 * parentMenu 为 null 的处理：
   * 附件二中 ID 为 1 的 "待办事项"，其 parentMenu 为 null。这就是根节点。
   * 附件二中 ID 为 2 的 "待办列表"，其 parentMenu 为 "UnfinishedList"。这对应 ID 为 1 的 authIdentifier。
   * 我的 listToTree 函数专门针对这种结构进行了匹配。
 * Vben Admin 的样式：
   * 如果你想保持 Vben 的风格，确保你的页面容器有适当的 padding。
   * 如果数据量非常大（超过几千条），建议在 <a-tree> 上添加 virtual 属性或设置 :height 属性来开启虚拟滚动，防止页面卡顿。
下一步建议：
你需要确认一下，当你点击“保存”时，后端是需要你传所有的 authIdentifier 数组，还是需要区分半选状态（Half-checked）？目前的 v-model:checkedKeys 默认只包含完全选中的节点。如果需要半选节点（父节点），可能需要使用 @check 事件来手动获取 info.halfCheckedKeys。
